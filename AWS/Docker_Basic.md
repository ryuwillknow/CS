# Docker

VM은 가상화된 하드웨어와 OS를 구축. 프로세스 격리관점에서는 좋지만 성능에서 단점이 있다. 

컨테이너는 가상화와 다르게 프로세스의 실행환경을 격리화한다. 호스트 입장에서 컨테이너는 하나의 프로세스일 뿐이다.

운영체제 상에서 지원하는 방법을 통해서 하나의 프로세스(컨테이너)를 실행하기 위한 별도의 환경을 구축하는 일을 지원하고, 도커는 바로 프로세스를 격리시켜 실행해주는 도구라고 할 수 있습니다.

사용자용 가상머신Virtual Machine은 이제 대중적인 도구가 되었습니다. 가상머신을 실행하는 호스트 머신에 가상화된 하드웨어와 OS를 구축함으로써, 호스트와는 다른 환경을 구축하고 개발과 테스트를 비롯한 다양한 목적으로 사용할 수 있습니다.

이미지와 컨테이너는 도커를 이해하는 데 있어 가장 중요한 개념입니다. 여기서는 먼저 이미지 개념에 대해서 같이 살펴보겠습니다. 이미지는 가상머신에서 사용하는 이미지와 비슷한 역할을 합니다. 한 마디로 정의해보자면 이미지는 어떤 애플리케이션을 실행하기 위한 환경이라고 할 수 있습니다.

그리고 이 환경은 파일들의 집합입니다. 도커에서는 애플리케이션을 실행하기 위한 파일들을 모아놓고, 애플리케이션과 함께 이미지로 만들 수 있습니다. 그리고 이 이미지를 기반으로 애플리케이션을 바로 배포할 수 있습니다.

이 도커 파일로 도커 이미지를 만들 수 있습니다. 도커 파일이 **서버 운영 기록**이라면, 도커 이미지는 운영 기록을 **실행할 시점**이라고 할 수 있습니다.

## VM과 Container

VM은 OS위에 Hypervisor를 실행시키고 이 위에 virtual machine 안에 os를 가동시킨다. 

반면 container는 hypervisor 대신에 container runtime을 실행시키고 그 위에 container를 실행시킨다. os가 없다. 즉 컴퓨터에 설치된 OS는 1개이다.

하이퍼바이저는 개별 vm에게 자원을 할당한다. 반면 container는 os에서 자원을 할당한다. 각각 가상머신은 완전히 격리된지만 container는 os는 공유된다. 둘다  cpu 메모리를 독립적으로 사용하여 한 프로그램이 오류가 나더라도 다른 프로그램에 영향을 끼치지 않는다. 단 container는 os에 문제가 생기면 전체가 멈출 수 있다. namespace 와 cgroup이 메모리를 독립적으로 사용할 수 있도록 돕는다.

가상머신은 한 가상머신에 여러개의 프로세스 실행가능 하지만 container는 격리된 프로세스이다. 이미지 위에 여러개 가능??

## 서버 코드화의 장점

지금까지 살펴본 내용이 모두 서버 코드화가 가져다 준 장점입니다.

1. 서버 제작 과정에 견고함과 유연성을 더할 뿐 아니라
2. 다른 이가 만든 서버를 소프트웨어 사용하듯 가져다 쓸 수 있고
3. 여러 대에 배포할 수 있는 확장성

이런 점들 덕에 서버 지식이 부족한 저같은 백엔드 개발자도 큰 힘을 들이지 않고 서버를 운영할 수 있습니다.

### curl Client URL 로

Linux나 Mac OS 에는 curl 명령어 패키지가 기본 탑재되어 있다. Window에서도 설치하여 사용할수 있지만 일반적으로 윈도우에는 편히라게 사용 가능한 tool이나 Postman과 같은 프로그램들이 많기 때문에 잘 사용하지 않는 편이긴 하다.

sudo ⇒ 윈도우에서는 관리자 권한으로 실행해서 한다.

윈도우는 docker of window를 사용해야한다. linux에서 편하게 사용할 수 있다. 이를 위해서는 wsl을 다운 받아야한다.

### 일단 기본 예제

`docker run -it centos:latest bash` 명령어는 `centos:latest` 이미지로부터 `bash`를 실행하라는 의미입니다. 아직 이미지가 없다면, 도커의 공식 저장소에서 이 이미지를 풀 받아옵니다.* 그리고 이 이미지를 기반으로 `bash` 프로세스를 실행합니다.

도커 사에서는 우분투Ubuntu, 센트OSCentOS와 같이 리눅스 운영체제 이미지와 MySQL, 레디스Redis, 워드프레스Wordpress와 같이 자주 사용되는 애플리케이션에 대한 공식 이미지를 제공하고 있습니다. 앞서 풀 받은 센트OS 이미지는 도커가 공식적으로 제공하는 이미지에 해당합니다.

## 컨테이너와 이미지

도커는 이미지를 받아올 때 pull을 활용한다. 

docker hub는 docker의 공식 이미지 레지스트리이다. yarn npm pip 같은 거다!!

1. 도커 레지스트리에서 centos 이미지를 풀 받아서 로컬로 다운로드 받는다.
2. 이 이미지를 통해서 컨테이너를 실행한다.

이미지는 어떤 환경이 구성되어있는 상태를 저장해놓은 파일 집합이라고 이야기했습니다. 바로 이 이미지의 환경 위에서 특정한 프로세스를 격리시켜 실행한 것을 컨테이너라고 부릅니다.

컨테이너는 `docker run`를 통해서 실행할 수 있습니다. 여기서는 셸을 실행하기 위해서 `-it`를 옵션을 붙였습니다. `docker run -it <이미지이름:태그> <명령어>`로 `centos` 이미지 기반의 컨테이너를 하나 실행시켜보겠습니다.

컨테이너는 **격리된 환경에서 실행되는 프로세스**

셸은 대화형으로 리눅스 머신에 명령을 실행하기 위한 커맨드라인 도구입니다. 프로세스이기 때문에 셀을 종료하면, 그걸로 끝입니다. 반면에 SSH는 외부에서 접속하기 위해 설치해두는 서버 프로세스입니다. 따라서 SSH 서버에 접속해서 셸을 사용하고 종료하더라도 SSH 서버는 그대로 살아서 다른 접속을 기다립니다. 겉보기에는 비슷하지만 도커로 셸을 직접 실행해서 사용하는 것과 외부 서버에 SSH로 접속하는 것의 차이를 명확하게 이해해야 도커 컨테이너와 가상머신이 헷갈리지 않을 수 있습니다.

### docker 명령어 모음

`docker run -it <이미지이름:태그> <명령어>`

`docker ps`

`docker restart d3fef9c0f9e9`

`docker attach d3fef9c0f9e9`

https://hub.docker.com/  도커 허브

이 외에도 실행된 컨테이너를 강제로 종료시키는 `stop` 명령어가 있으며, 종료된 컨테이너를 삭제하는 `rm` 명령어도 있습니다. 잠시 기억을 더듬어 올라가 이 글의 초반부에서 `run` 명령어와 함께 사용한 `--rm` 플래그는 컨테이너가 종료 상태가 되면 자동으로 삭제를 해주는 옵션입니다.
