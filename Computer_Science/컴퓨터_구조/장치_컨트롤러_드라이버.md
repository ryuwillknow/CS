## 장치 컨트롤러와 장치 드라이버

여기서 중요한 사실 - 하드디스크, SSD도 입출력장치에 포함된다. 

장치의 종류가 다양한 만큼 신호의 종류도 다양하다. CPU와 메모리의 전송률보다 입출력장치의 데이터 전송률이 낮다. 이 두 가지 특징 때문에 CPU와 입출력 장치간의 직접 소통이 어렵다. 그래서 입출력장치는 장치컨트롤러라는 하드웨어를 통해 컴퓨터와 연결된다. 장치 컨트롤러는 입출력 제어기와 입출력 모듈등으로 불리기도 한다. 장치 컨트롤러는 CPU와 입출력장치 간의 통신을 중개하고 오류를 검출하고 데이터 버퍼링한다. 데이터 버퍼링이란 CPU와 입출력 장치간의 전송률차이를 극복하기위해 주고 받은 데이터를 버퍼라는 임시공간에 저장하여 전송률을 비슷하게 맞추는 기술이다. 간단히 말하면 한번에 받아서 조금씩 보내고 모아서 한번에 보내는 것을 의미한다. 장치 컨트롤러 내부에는 데이터 레지스터(데이터를 저장한다. 데이터가 많으면 레지스터 대신 메모리를 사용하기도한다.), 상태 레지스터(완료여부, 준비여부, 오류여부), 제어 레지스터(제어정보와 명령)가 존재한다. 장치드라이버는 컨트롤러가 컴퓨터 내부와 점보를 주고받을 수 있게 하는 프로그램이다. 이 프로그램 역시 메모리에 저장된다. 

다양한 입출력방법 : CPU와 장치 컨트롤러가 정보를 주고받는 방법은 프로그램 입출력, 인터럽트 기반 입출력, DMA 입출력이다. 프로그램입출력은 CPU가 컨트롤러의 제어레지스터에 명령을 보내면 컨트롤러는 하드디스크의 상태를 확인하고 상태레지스터에 준비완료되었다고 표시한다. CPU는 주기적으로 상태레지스터를 확인하면서 테이터 레지스터에 메모리 정보를 쓴다. 매모리 맵 입출력방식은 메모리에 접근하기 위한 주소공간과 입출력장치에 접근하기 위한 주소공간을 하나의 주소 공간으로 간주하는 방법이다. 둘에 접근할 때 같은 명령어를 사용한다. 반면 고립형 입출력 방식은 둘을 분리한 후 입출력 전용 명령어를 사용한다. 인터럽트 기반의 입출력방식은 CPU가 장치 컨트롤러에 요청을 보내고 장치 컨트롤러는 작업을 완료한 후 CPU에 인터럽트 요청을 보내는 방식이다. 하지만 하나의 인터럽트 서비스 루틴이 진행중에 발생하는 다른 인터럽트 서비스루틴은 두가지로 나눠서 처리한다. 하나는 CPU 플래그 레지스터의 인터럽트 비트가 비활성화 되어있으면 그 서비스 루틴이 끝난다음에 순차적으로 나중에 발생한 서비스를 실행한다. 하지만 우선순위에 따라 인터럽트를  실행할 수도 있다. 플래그 레지스터 속 인터럽트 비트가 비활성화돼도 무시할 수 없는 인터럽트인 NMI(Non-Maskable Interrupt, 가장 순위가 높음)가 발생한 경우 먼저 실행한다. 또 많은 컴퓨터가 프로그래머블 인터럽트 컨트롤러(PIC)라는 하드웨어를 사용하면서 인터럽트 요청의 우선순위를 판별해 CPU가 지금 처리해야할 하드웨어 인터럽트가 무엇인지 알려준다. 복잡하면 두 개 이상의 층으로 PIC를 구성한다. DMA(Direct Memory Access) 입출력과정은 CPU의 연산을 DMA 컨트롤러가 대신 상호작용하면서 수행하는 방법이다.(완료 후에는 인터럽트 신호를 보냄) 메모리가 CPU로 가고 다시 장치 컨트롤러로 가는 방법은 CPU의 연산에 비효율적이기 때문이다. 하지만 시스템 버스는 공용자원이고 CPU와 DMA 컨트롤러가 동시에 사용하는 것이 불가능하다. 그래서 입출력 버스가 만들어졌다. 메모리에서 DMA 컨트롤러로, DMA 컨트롤러에서 장치 컨트롤러로 옮길 때 시스템 버스를 2번 사용하지만 입출력 버스로 연결하면 시스템 버스 사용빈도가 줄어든다. 입출력 버스는 PCI 버스, PCI Express(PCLe)등이 있다!! 땡
